## Docker Compose
지금까지는: 
> docker run mysql
docker run spring-app

문제: 컨테이너가 각각 따로 놀음
	 실행 순서, 네트워크, 환경변수 관리가 지옥!
     
Docker Compose는 여러 컨테이너의 실행 설명서
	어떤 컨테이너를
    어떤 이미지로
    어떤 포트로
    어떤 네트워크로 
    어떤 환경변수로...
    
## docker-compose.yml 기본 구조 
> version: "3.8"

	services:
  	db:
    image: mysql:8.0

  	app:
   	 image: my-app
   
  | 항목       | 의미                |
| -------- | ----------------- |
| version  | compose 문법 버전     |
| services | 실행할 컨테이너 묶음       |
| db, app  | 컨테이너 이름 (⭐ 매우 중요) |

## MySQL 컨테이너 정의
> services:
  db:
    image: mysql:8.0
    container_name: sda-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: sda_db
    ports:
      - "3306:3306"

image: MySQL 8.0 이미지

environment: MySQL 최초 설정

ports:

내 PC ↔ 컨테이너 연결용

DB 툴(DBeaver, MySQL Workbench) 접속 가능

## Spring(App) 컨테이너 정의
> services:
  app:
    build: .
    container_name: sda-app
    ports:
      - "8080:8080"
    depends_on:
      - db
      
build: . → Dockerfile 사용

depends_on → db 먼저 실행

이건 “순서”만 보장, DB 준비 완료는 아님

## 컨테이너 간 통신의 핵심 개념
하면 안되는 것
> spring.datasource.url=jdbc:mysql://localhost:3306/sda_db

이유: app 컨테이너 입장에서 localhost = 자기 자신

정답
> spring.datasource.url=jdbc:mysql://db:3306/sda_db

db?
> services:
  db:
  
db는 네트워크 주소/ service이름=컨테이너의 DNS 이름

## 전체 docker-compose.yml
> version: "3.8"

	services:
  	db:
    image: mysql:8.0
    container_name: sda-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: sda_db
    ports:
      - "3306:3306"

  	app:
    build: .
    container_name: sda-app
    ports:
      - "8080:8080"
    depends_on:
      - db

## 실행 & 종료 명령어
### 실행
> docker compose up -d --build

-d : 백그라운드

--build : 이미지 다시 빌드
### 상태 확인
> docker compose ps
### 로그 확인
> docker compose logs -f app
### 종료
> docker compose down
