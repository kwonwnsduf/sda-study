# GROUP BY
GROUP BY = “여러 row를 의미 있는 요약 데이터로 바꾸는 것”

## GROUP BY가 왜 필요할까?
예를 들어 주문 테이블이 이렇다고 한다.
> orders
id | member_id | price
1  | 1         | 10000
2  | 1         | 20000
3  | 2         | 15000

질문:
	회원별 주문 금액 합계는?

	회원별 주문 개수는?
    
->이건 SELECT만으로 불가능/group by 필요

## GROUP BY 기본구조
> SELECT 그룹컬럼, 집계함수
FROM 테이블
GROUP BY 그룹컬럼;

예시:
> SELECT member_id, COUNT(*) AS order_count
FROM orders
GROUP BY member_id;

member_id 기준으로 묶고

각 그룹의 row 개수를 센다

## 자주 쓰는 집계 함수
| 함수         | 의미         |
| ---------- | ---------- |
| COUNT(*)   | 행 개수       |
| COUNT(col) | NULL 제외 개수 |
| SUM(col)   | 합계         |
| AVG(col)   | 평균         |
| MIN(col)   | 최소         |
| MAX(col)   | 최대         |
예:
> SELECT
  member_id,
  COUNT(*) AS cnt,
  SUM(price) AS total_price,
  AVG(price) AS avg_price
FROM orders
GROUP BY member_id;

## GROUP BY 규칙
나쁜 예:
> SELECT member_id, price
FROM orders
GROUP BY member_id;

왜 안 될까?

	member_id 하나에 price가 여러 개

	어떤 price를 보여줄지 모름

규칙:
	SELECT에 있는 컬럼은GROUP BY에 있거나 집계 함수여야 한다

## HAVING-그룹 조건
WHERE랑 뭐가 다를까?

	WHERE → row 필터

	HAVING → 그룹 필터

나쁜 예:
> WHERE COUNT(*) >= 2;

좋은 예:
> SELECT member_id, COUNT(*) AS cnt
FROM orders
GROUP BY member_id
HAVING COUNT(*) >= 2;
SELECT member_id, COUNT(*) AS cnt
FROM orders
GROUP BY member_id
HAVING COUNT(*) >= 2;

## WHERE + GROUP BY + HAVING 실행 흐름
> FROM
WHERE        -- row 필터
GROUP BY
HAVING       -- 그룹 필터
SELECT
ORDER BY
LIMIT

## 예시
> SELECT seller_id, SUM(price) AS total_sales
FROM orders
WHERE status = 'PAID'
GROUP BY seller_id;

> SELECT member_id, COUNT(*) AS order_cnt
FROM orders
GROUP BY member_id
HAVING COUNT(*) >= 3;

