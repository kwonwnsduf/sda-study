#정규화/비정규화

# 정규화
## 정규화란
데이터 중복 제거 + 이상 현상 방지를 위한 설계 과정

## 함수 종속
> A → B
A 값을 알면 B 값이 항상 하나로 결정

ex) 학번 → 이름
	학번 → 학과

## 정규화 단계별 판단기준
### 1NF
반복 그룹 제거

	하나의 컬럼에 값 여러 개 X

	컬럼은 원자값

전화번호: 010-xxx, 010-yyy (x)

전화번호 테이블 분리

->컬럼이 쪼개져야 하면 1NF 위반

### 2NF
부분 함수 종속 제거

	복합 PK일 때만 문제
    
    PK 일부에만 종속된 컬럼 x
    
ex) (주문번호, 상품번호) → 상품명

	상품명은 상품번호만으로 결정됨
    
    부분 종속-> 2NF 위반
    
복합키 + 키 일부에만 종속된 속성 = 2NF

### 3NF
이행 함수 종속 제거
> PK → A → B

ex) 사번PK → 부서코드
	부서코드 → 부서명
    
사번->부서명(이행 종속 발생)

"키가 아닌 속성이 다른 속성을 결정하면 3NF 위반"

# 반정규화

## 반정규화란
성능 향상을 위해 일부러 중복을 허용하는 것

> 주문 → 회원 (JOIN)
주문 → 주문상품 → 상품 (JOIN 2번)

  
정규화된 구조, 조회할 때마다 JOIN 여러 번/ 데이터 많아질 수록 느려짐

> 주문(회원명, 총금액 포함)

반정규화 후, JOIN 줄어듦/조회 쿼리 단순/응답 빨라짐

## 반정규화 유형

### 테이블 병합

1:1, 1:N 관계 테이블 합침

JOIN 제거 목적

ex) 회원 + 회원상세 → 회원
> 회원(id, name)
회원상세(id, address, phone)

병합
> 회원(id, name, address, phone)


### 중복 컬럼 추가

자주 조회되는 컬럼을 부모/자식에 중복 저장

ex) 주문 테이블에 회원명 추가
> 회원(id, name)
주문(order_id, member_id)

반정규화
> 주문(order_id, member_id, member_name)


### 파생 컬럼 추가

계산 결과 저장

ex) 총주문금액 = 수량 × 단가
> 주문상품
- 수량
- 단가
SELECT SUM(수량 * 단가)
FROM 주문상품
WHERE 주문번호 = 1;

반정규화
> SELECT 총주문금액
FROM 주문
WHERE 주문번호 = 1;
(총주문금액 = 수량 × 단가 (미리 계산해서 저장))


## 반정규화 장단점

### 장점

JOIN 감소

조회 성능 향상

### 단점

데이터 중복

무결성 유지 어려움

갱신 비용 증가

## 반정규화 고려 조건

조회 빈도 매우 높음

JOIN이 과도하게 발생

실시간 조회 성능 중요

데이터 변경 거의 없음

## 반정규화 X

데이터 변경 빈번

무결성 중요

트랜잭션 많음
    
## 성능 vs 무결성 

성능 → 반정규화

무결성 → 정규화
